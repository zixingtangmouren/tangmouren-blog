<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å‰è¨€ | å”æŸäººçš„åšå®¢</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="è¿™æ˜¯å”æŸäººçš„æŠ€æœ¯åšå®¢ï¼Œç”¨äºè®°å½•å¹³æ—¥é‡Œå­¦ä¹ JSï¼ŒVueï¼ŒWebpackï¼ŒReactçš„ç›¸å…³å¿ƒå¾—ã€‚">
    
    <link rel="preload" href="/tangmouren/assets/css/0.styles.14446835.css" as="style"><link rel="preload" href="/tangmouren/assets/js/app.6489800f.js" as="script"><link rel="preload" href="/tangmouren/assets/js/2.18399b14.js" as="script"><link rel="preload" href="/tangmouren/assets/js/10.fbff40b9.js" as="script"><link rel="prefetch" href="/tangmouren/assets/js/11.12521ef0.js"><link rel="prefetch" href="/tangmouren/assets/js/12.eed0a89c.js"><link rel="prefetch" href="/tangmouren/assets/js/13.afff178a.js"><link rel="prefetch" href="/tangmouren/assets/js/3.d7d6cdd2.js"><link rel="prefetch" href="/tangmouren/assets/js/4.09ee8a39.js"><link rel="prefetch" href="/tangmouren/assets/js/5.98155bf4.js"><link rel="prefetch" href="/tangmouren/assets/js/6.498ab014.js"><link rel="prefetch" href="/tangmouren/assets/js/7.57ce6d61.js"><link rel="prefetch" href="/tangmouren/assets/js/8.83873d28.js"><link rel="prefetch" href="/tangmouren/assets/js/9.719aaf58.js">
    <link rel="stylesheet" href="/tangmouren/assets/css/0.styles.14446835.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tangmouren/" class="home-link router-link-active"><!----> <span class="site-name">å”æŸäººçš„åšå®¢</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tangmouren/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/tangmouren/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/tangmouren/Vue/" class="nav-link router-link-active">
  Vue
</a></div><div class="nav-item"><a href="/tangmouren/Webpack/" class="nav-link">
  Webpack
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tangmouren/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/tangmouren/JS/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/tangmouren/Vue/" class="nav-link router-link-active">
  Vue
</a></div><div class="nav-item"><a href="/tangmouren/Webpack/" class="nav-link">
  Webpack
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>VueåŸç†</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tangmouren/Vue/" aria-current="page" class="sidebar-link">å¼€å§‹</a></li><li><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html" class="active sidebar-link">vue3ç»„ä»¶é€šä¿¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html#å‰è¨€" class="sidebar-link">å‰è¨€</a></li><li class="sidebar-sub-header"><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html#åŸºæœ¬æ“ä½œ" class="sidebar-link">åŸºæœ¬æ“ä½œ</a></li><li class="sidebar-sub-header"><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html#çˆ¶ä¼ å­" class="sidebar-link">çˆ¶ä¼ å­</a></li><li class="sidebar-sub-header"><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html#çˆ¶ä¼ æ›´æ·±çš„åä»£" class="sidebar-link">çˆ¶ä¼ æ›´æ·±çš„åä»£</a></li><li class="sidebar-sub-header"><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html#å­ä¼ çˆ¶" class="sidebar-link">å­ä¼ çˆ¶</a></li><li class="sidebar-sub-header"><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html#äº‹ä»¶ä¸­å¿ƒè¿›é˜¶" class="sidebar-link">äº‹ä»¶ä¸­å¿ƒè¿›é˜¶</a></li><li class="sidebar-sub-header"><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html#æ·±å±‚åä»£å‘é¡¶å±‚é€šä¿¡-å…„å¼Ÿé€šä¿¡" class="sidebar-link">æ·±å±‚åä»£å‘é¡¶å±‚é€šä¿¡ï¼Œå…„å¼Ÿé€šä¿¡</a></li><li class="sidebar-sub-header"><a href="/tangmouren/Vue/vue3ç»„ä»¶é€šä¿¡.html#æœ€å" class="sidebar-link">æœ€å</a></li></ul></li><li><a href="/tangmouren/Vue/å®ç°ä¸€ä¸ªç®€å•çš„Vue3æ¡†æ¶.html" class="sidebar-link">å®ç°ä¸€ä¸ªç®€å•çš„Vue3æ¡†æ¶</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>æœ€è¿‘åœ¨å’±ä»¬ç¤¾åŒºçœ‹åˆ°ä¸€ä½å¤§ä½¬çš„è¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/6903796293445877773" target="_blank" rel="noopener noreferrer">Vue ç»„ä»¶é€šä¿¡æ–¹å¼åŠå…¶åº”ç”¨åœºæ™¯æ€»ç»“<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œæ„Ÿè§‰å¯¹<code>vue2</code>çš„é€šä¿¡æ–¹å¼å’Œåº”ç”¨åœºæ™¯æ€»ç»“çš„éå¸¸åˆ°ä½ï¼Œæ‰€ä»¥å‘å¤§ä½¬ saluteğŸ˜„ã€‚åˆšå¥½æœ€è¿‘åœ¨å­¦ä¹ <code>vue3</code>ï¼Œäºæ˜¯ä¹Ÿæ€è€ƒæ€»ç»“ä¸€ä¸‹åœ¨<code>vue3</code>ä¸­çš„ç»„ä»¶é€šä¿¡çš„æ–¹å¼ã€‚</p> <p>æˆ‘ä»¬çŸ¥é“<code>vue3</code>çš„<code>Composition Api</code>æ˜¯å®ƒå‡ ä¸ªæœ€å¤§äº®ç‚¹ä¹‹ä¸€ï¼Œæ‰€ä»¥ä¸‹æ–‡éƒ½æ˜¯åœ¨<code>setup</code>ä¸­æ¼”ç¤ºä»£ç çš„å®ç°ã€‚åé¢ä¼šä»¥å¼€å‘å‡ ä¸ªç®€å•<code>formç»„ä»¶</code>ä¸ºä¾‹å­æ¥æ¼”ç¤ºã€‚</p> <h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="header-anchor">#</a> åŸºæœ¬æ“ä½œ</h2> <p>è¿™é‡Œå…ˆç®€å•å¼€å‘ä¸€ä¸ª<code>VInput</code>çš„è¾“å…¥æ¡†ç»„ä»¶ã€‚ç»„ä»¶å°±åƒä¸€ä¸ªå‡½æ•°ï¼Œä¸»è¦å°±æ˜¯å¤„ç†è¾“å…¥å’Œè¾“å‡ºã€‚<code>Vue3</code>åœ¨<code>setup</code>å‡½æ•°ä¸Šæä¾›äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ª<code>props</code>ï¼Œä¸€ä¸ªæ˜¯<code>context</code>ä¸‹é¢çš„<code>emit</code>æ–¹æ³•ï¼Œåˆ†åˆ«æ¥å¤„ç†è¾“å…¥å’Œè¾“å‡ºã€‚</p> <h3 id="props"><a href="#props" class="header-anchor">#</a> props</h3> <p>ç°åœ¨<code>VInput</code>å°±æ˜¯å­ç»„ä»¶ï¼Œæˆ‘éœ€è¦å®ƒèƒ½å¤Ÿæ¥å—çˆ¶çº§ä¼ é€’ä¸€ä¸ªå€¼ï¼Œè®©å®ƒå¯ä»¥å¸®æˆ‘åšåç»­çš„é€»è¾‘å¤„ç†åœ¨è¿”å›ç»™çˆ¶çº§ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œéœ€è¦æœ€åŸºæœ¬çš„ä¸€äº›çˆ¶å­é€šä¿¡æ–¹å¼<code>v-bind</code>ï¼Œ<code>props</code>ã€‚</p> <p><strong>çˆ¶çº§ç»„ä»¶ä¸­</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
   <span class="token comment">// é€šè¿‡v-bindå°†æ•°æ®æƒ³å­ç»„ä»¶ä¼ é€’</span>
  <span class="token operator">&lt;</span>VInput <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;valueRef&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token keyword">const</span> valueRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>VInput ä¸­</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span> <span class="token keyword">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'VInput'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å…¶ä»–é€»è¾‘</span>

    <span class="token comment">// æ¥å—åˆ°è¿™ä¸ªå€¼</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h3 id="emit"><a href="#emit" class="header-anchor">#</a> emit</h3> <p>å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸­æ¥å—å‚æ•°ï¼Œè¿›è¡Œä¸€äº›é€»è¾‘å¤„ç†åï¼Œæˆ‘ä»¬å°±éœ€è¦å°†å¤„ç†å¥½çš„å€¼ï¼Œå‘å¤–éƒ¨è¿›è¡Œä¸€ä¸ªè¿”å›ï¼Œå¤–éƒ¨åŒæ—¶éœ€è¦å®ç°ä¸€ä¸ªäº‹ä»¶å‡½æ•°å»æ¥å—ã€‚æ­¤æ—¶æˆ‘å°±å¯ä»¥ä½¿ç”¨<code>emit</code>æ–¹æ³•</p> <p>å‡è®¾æˆ‘ä»¬å¸Œæœ›<code>VInput</code>ç»„ä»¶è¿”å›ç»™å¤–éƒ¨çš„æ˜¯ä¸€ä¸ªé™åˆ¶é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚æ­¤æ—¶å¤–éƒ¨å°±éœ€è¦å®ç°ä¸€ä¸ªå¯¹åº”çš„äº‹ä»¶å‡½æ•°å»æ¥æ”¶è¿™ä¸ªå€¼ï¼Œç„¶å<code>VInput</code>å†…éƒ¨é€š<code>emit</code>æ‰§è¡Œäº‹ä»¶ï¼Œå°†å†…éƒ¨çš„å¤„ç†å¥½çš„å€¼å½“åšå‚æ•°è¿”å›å‡ºå»ã€‚</p> <p><strong>VInput</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span> <span class="token keyword">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> @input<span class="token operator">=</span><span class="token string">&quot;onInput&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;inputRef&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'VInput'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> String<span class="token punctuation">,</span>
    maxLength<span class="token operator">:</span> Number
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// Vue3ä¸­è·å–ç»„ä»¶æˆ–è€…domå®ä¾‹çš„ä¸€ç§æ–¹å¼</span>
    <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// é™åˆ¶æ–‡å­—é•¿åº¦</span>
    <span class="token keyword">const</span> <span class="token function-variable function">limitLength</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> maxLength<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      value<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> maxLength<span class="token punctuation">)</span>


    <span class="token comment">// è¾“å…¥æ§åˆ¶</span>
    <span class="token keyword">const</span> <span class="token function-variable function">controlled</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      inputRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token function-variable function">onInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> props<span class="token punctuation">.</span>maxLength <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">&amp;&amp;</span> props<span class="token punctuation">.</span>maxLength <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> <span class="token function">limitLength</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> props<span class="token punctuation">.</span>maxLength<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token function">controlled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>

      <span class="token comment">// å‘å¤–éƒ¨è¿”å›ä¸€ä¸ªå¤„ç†è¿‡çš„å€¼</span>
      <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'onInput'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      onInput<span class="token punctuation">,</span>
      inputRef
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>çˆ¶çº§ç»„ä»¶</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token comment">// é€šè¿‡v-onå‘å­ç»„ä»¶ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æˆ·æ¥å—è¿”å›å€¼</span>
  <span class="token operator">&lt;</span>VInput <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;valueRef&quot;</span> <span class="token operator">:</span>maxLength<span class="token operator">=</span><span class="token string">&quot;10&quot;</span> @onInput<span class="token operator">=</span><span class="token string">&quot;onInput&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VInput <span class="token keyword">from</span> <span class="token string">'@/components/VInput.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Demo'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    VInput
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> valueRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">onInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token comment">// æ¥å—å­ç»„ä»¶VInputè¿”å›çš„å€¼</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token comment">// æ”¹å˜å¯¹åº”çš„å€¼</span>
      valueRef<span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      valueRef<span class="token punctuation">,</span>
      onInput
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>å¯¹äºè¿™ç§<code>input</code>çš„ç»„ä»¶çš„ä½¿ç”¨ï¼Œæˆ‘çŒœå¤§å®¶è‚¯å®šéƒ½ä¸æƒ³åœ¨çˆ¶çº§ç»„ä»¶è¿™ä¹ˆéº»çƒ¦çš„å»æ¥æ”¶å’Œæ”¹å˜ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥<code>vue</code>æ˜¯æä¾›äº†<code>v-model</code>æ¥æ›´å¿«æ·çš„å®ç°è¾“å…¥å’Œè¾“å‡ºã€‚</p> <h3 id="v-model"><a href="#v-model" class="header-anchor">#</a> v-model</h3> <p>é€šè¿‡<code>Vue3</code>çš„æ–‡æ¡£å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªæŒ‡ä»¤çš„ç”¨æ³•å‘ç”Ÿäº†ä¸€å®šçš„å˜åŒ–ã€‚åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬è¦æƒ³å®ç°ä¸€ä¸ª<strong>è‡ªå®šä¹‰çš„éè¡¨å•ç»„ä»¶</strong>çš„åŒå‘ç»‘å®šï¼Œéœ€è¦é€šè¿‡<code>xxxx.sync</code>çš„è¿™ç§è¯­æ³•æ¥å®ç°ï¼Œå¦‚ä»Šè¿™ä¸ªæŒ‡ä»¤å·²ç»è¢«åºŸé™¤äº†ï¼Œè€Œæ˜¯ç»Ÿä¸€ä½¿ç”¨<code>v-model</code>è¿™ä¸ªæŒ‡ä»¤ã€‚</p> <p><strong>çˆ¶çº§ç»„ä»¶</strong></p> <p>æ–°çš„<code>v-model</code> è¿˜å¯ä»¥æ”¯æŒå¤šä¸ªæ•°æ®çš„åŒå‘ç»‘å®šã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>VBtn v<span class="token operator">-</span>model<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;valueRef&quot;</span> v<span class="token operator">-</span>model<span class="token operator">:</span>keyword<span class="token operator">=</span><span class="token string">&quot;keywordRef&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><p><strong>è‡ªå®šä¹‰çš„éè¡¨å•ç»„ä»¶</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;clickHandle&quot;</span><span class="token operator">&gt;</span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'VBtn'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> String<span class="token punctuation">,</span>
    keyword<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// çœç•¥å…¶ä»–ä»£ç </span>

     <span class="token comment">// ç”¨æˆ·ç‚¹å‡»æŒ‰é’®</span>
    <span class="token keyword">const</span> <span class="token function-variable function">clickHandle</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// çœç•¥å…¶ä»–ä»£ç </span>

      <span class="token comment">// ä¿®æ”¹å¯¹åº”çš„propsçš„æ•°æ®</span>
      <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:value'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
      <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:keyword'</span><span class="token punctuation">,</span> value <span class="token operator">+</span> <span class="token string">'123'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>ä»¥ä¸Šå°±æ˜¯åœ¨<code>Vue3</code>ä¸­ä¸€äº›åŸºæœ¬é€šä¿¡æ–¹å¼çš„ API çš„ä»‹ç»ã€‚åœ¨<code>Vue3</code>ä¸­ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨<code>Composition Api</code>çš„å½¢å¼å¼€å‘ï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°å¼€å‘çš„æ—¶å€™ä¸èƒ½åœ¨é‡‡ç”¨<code>this.$xxx</code>çš„æ–¹å¼å»è°ƒç”¨å®ä¾‹ä¸Šçš„æŸä¸ªå‡½æ•°æˆ–è€…æ˜¯å±æ€§ã€‚é‚£äº›<code>this.$parent</code>ï¼Œ<code>this.$children</code>ï¼Œ<code>this.$on</code>ï¼Œ<code>this.$emit</code>ç­‰ç­‰éƒ½ä¸èƒ½åœ¨ä½¿ç”¨äº†ã€‚</p> <p>é‚£åœ¨<code>Vue3</code>ä¸­å¦‚ä½•è§£å†³ç»„ä»¶é—´é‚£äº›é€šä¿¡çš„å‘¢ï¼Ÿå’±ä»¬ä»ç®€å•åˆ°å¤æ‚çš„åœºæ™¯ï¼Œä¸€ä¸ªä¸ªæ¥åˆ†æã€‚</p> <p>å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œå¼€å‘çš„ä¸‰ä¸ª<code>form</code>ç»„ä»¶ï¼Œç»„åˆèµ·æ¥çš„å®é™…çš„ç”¨æ³•æ˜¯æ€ä¹ˆæ ·çš„:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ValidateForm ref<span class="token operator">=</span><span class="token string">&quot;validateFormRef1&quot;</span> <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">&quot;state&quot;</span> <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">&quot;rules&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·å&quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;keyword&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ValidateInput
        placeholder<span class="token operator">=</span><span class="token string">&quot;è¯·è¾“å…¥&quot;</span>
        required
        v<span class="token operator">-</span>model<span class="token operator">:</span>modelValue<span class="token operator">=</span><span class="token string">&quot;state.keyword&quot;</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;å¯†ç &quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>ValidateInput
        placeholder<span class="token operator">=</span><span class="token string">&quot;è¯·è¾“å…¥&quot;</span>
        required
        <span class="token keyword">type</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span>
        v<span class="token operator">-</span>model<span class="token operator">:</span>modelValue<span class="token operator">=</span><span class="token string">&quot;state.password&quot;</span>
      <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateForm<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn btn-primary&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;submit(0)&quot;</span><span class="token operator">&gt;</span>æäº¤<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><p>æ‰€æœ‰ç»„ä»¶çš„åŠŸèƒ½ï¼Œæ˜¯æ¨¡ä»¿<code>Element UI</code>å»å®ç°çš„ã€‚</p> <h2 id="çˆ¶ä¼ å­"><a href="#çˆ¶ä¼ å­" class="header-anchor">#</a> çˆ¶ä¼ å­</h2> <p>çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’ä¸€ä¸ªæ•°æ®ï¼Œå¯ä»¥ç”¨è¿™ä¸¤ç§æ–¹å¼ï¼š</p> <ul><li>v-bind</li> <li>refs è·å–å­ç»„ä»¶å†…éƒ¨æŸä¸ªå‡½æ•°ï¼Œç›´æ¥è°ƒç”¨ä¼ å‚ï¼ˆè¿™é‡Œç®€ç§° refs æ–¹å¼ï¼‰</li></ul> <h3 id="refs-æ–¹å¼"><a href="#refs-æ–¹å¼" class="header-anchor">#</a> refs æ–¹å¼</h3> <p>å…³äº<code>v-bind</code>å’±ä»¬å°±ä¸ç»†è¯´äº†ï¼Œåœ¨åŸºæœ¬æ“ä½œç« èŠ‚å·²ç»è®²è¿‡å…¶å¯¹åº”çš„ä½¿ç”¨æ–¹å¼äº†ã€‚è¿™å°èŠ‚ä¸»è¦åœ¨ä¸­è®²<code>Vue3</code>å¦‚ä½•é€šè¿‡<code>ref</code>è·å–å­ç»„ä»¶å®ä¾‹å¹¶è°ƒç”¨å…¶èº«ä¸Šçš„å‡½æ•°æ¥å¯¹å­ç»„ä»¶è¿›è¡Œä¼ å€¼ã€‚</p> <p><strong>å­ç»„ä»¶</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token comment">// æ¸²æŸ“ä»çˆ¶çº§æ¥å—åˆ°çš„å€¼</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Son<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> valueRef <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Son'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> valueRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

    <span class="token comment">// è¯¥å‡½æ•°å¯ä»¥æ¥å—çˆ¶çº§ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¿®æ”¹valueRefçš„å€¼</span>
    <span class="token keyword">const</span> <span class="token function-variable function">acceptValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>valueRef<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      acceptValue<span class="token punctuation">,</span>
      valueRef
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>çˆ¶ç»„ä»¶</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>sonRef<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;sendValue&quot;</span><span class="token operator">&gt;</span>send<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token comment">// è¿™é‡Œrefæ¥å—çš„å­—ç¬¦ä¸²ï¼Œè¦setupè¿”å›çš„refç±»å‹çš„å˜é‡åŒå</span>
  <span class="token operator">&lt;</span>Son ref<span class="token operator">=</span><span class="token string">&quot;sonRef&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'@/components/Son.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Demo'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    Son
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœrefåˆå§‹å€¼æ˜¯ä¸€ä¸ªç©ºï¼Œå¯ä»¥ç”¨äºæ¥å—ä¸€ä¸ªå®ä¾‹</span>
    <span class="token comment">// vue3ä¸­è·å–å®ä¾‹çš„æ–¹å¼å’Œvue2ç•¥æœ‰ä¸åŒ</span>
    <span class="token keyword">const</span> sonRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">sendValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¯ä»¥æ‹¿åˆ°sonç»„ä»¶å®ä¾‹ï¼Œå¹¶è°ƒç”¨å…¶setupè¿”å›çš„æ‰€æœ‰ä¿¡æ¯</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sonRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

      <span class="token comment">// é€šè¿‡è°ƒç”¨sonç»„ä»¶å®ä¾‹çš„æ–¹æ³•ï¼Œå‘å…¶ä¼ é€’æ•°æ®</span>
      sonRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">acceptValue</span><span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sonRef<span class="token punctuation">,</span>
      sendValue
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>è¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹æµç¨‹å›¾ï¼š
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1dad085f528c47a49fee4ee2daa3f177~tplv-k3u1fbpfcp-watermark.image" alt="">
å…¶å®è¿™ç§æ–¹å¼è·Ÿ<code>Vue2</code>ä¸­ä½¿ç”¨<code>this.$refs</code>ï¼Œ<code>this.$children</code>çš„æ–¹å¼å¾ˆç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡æ‹¿åˆ°å­ç»„ä»¶å®ä¾‹ï¼Œç›´æ¥è°ƒç”¨å­ç»„ä»¶èº«ä¸Šçš„å‡½æ•°ã€‚æ–¹æ³•åƒç¯‡ä¸€å¾‹ï¼Œä¸è¿‡åœ¨<code>Vue3</code>ä¸­æ²¡æœ‰äº†<code>this</code>è¿™ä¸ªé»‘ç›’ã€‚</p> <p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°çœ‹ä¸€ä¸‹è¿™ä¸ª<code>sonRef.value</code>æ˜¯ä¸€ä¸ªæ€æ ·çš„ä¸œè¥¿ã€‚</p> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e60113a245aa407090ceb65b280c09ea~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p>å¯ä»¥å‘ç°ï¼Œé€šè¿‡<code>ref</code>è·å–åˆ°çš„å­ç»„ä»¶å®ä¾‹ä¸Šé¢å¯ä»¥æ‹¿åˆ°<code>setup</code>è¿”å›çš„æ‰€æœ‰å˜é‡å’Œæ–¹æ³•ï¼ŒåŒæ—¶è¿˜å¯ä»¥æ‹¿åˆ°å…¶ä»–çš„ä¸€äº›å†…éƒ¨å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£<a href="https://vue-composition-api-rfc.netlify.app/zh/api.html#%E6%A8%A1%E6%9D%BF-refs" target="_blank" rel="noopener noreferrer">Vue ç»„åˆå¼ API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>çš„æè¿°ã€‚</p> <blockquote><p>åœ¨ Virtual DOM patch ç®—æ³•ä¸­ï¼Œå¦‚æœä¸€ä¸ª VNode çš„ ref å¯¹åº”ä¸€ä¸ªæ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­çš„ refï¼Œåˆ™è¯¥ VNode å¯¹åº”çš„å…ƒç´ æˆ–ç»„ä»¶å®ä¾‹å°†è¢«åˆ†é…ç»™è¯¥ refã€‚ è¿™æ˜¯åœ¨ Virtual DOM çš„ mount / patch è¿‡ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå› æ­¤æ¨¡æ¿ ref ä»…åœ¨æ¸²æŸ“åˆå§‹åŒ–åæ‰èƒ½è®¿é—®ã€‚</p></blockquote> <p><strong>ref æ–¹å¼æ€»ç»“</strong></p> <p>ä¼˜ç‚¹ï¼š</p> <ol><li>çˆ¶ç»„ä»¶å¯ä»¥è·å–å¿«é€Ÿå‘<strong>ç¡®å®šå­˜åœ¨çš„</strong>å­ç»„ä»¶ä¼ é€’æ•°æ®</li> <li>ä¼ é€’çš„å‚æ•°ä¸å—é™åˆ¶ï¼Œä¼ é€’æ–¹å¼æ¯”è¾ƒçµæ´»</li></ol> <p>ç¼ºç‚¹ï¼š</p> <ol><li>ref è·å–çš„å­ç»„ä»¶å¿…é¡»ç¡®å®šå­˜åœ¨çš„ï¼ˆä¸ç¡®å®šå­˜åœ¨çš„æƒ…å†µï¼šå¦‚æ’æ§½ä¸Šå­ç»„ä»¶ï¼Œ<code>v-if</code>æ§åˆ¶çš„å­ç»„ä»¶ï¼‰</li> <li>å­ç»„ä»¶è¿˜éœ€è¦å®ç°æ¥å—å‚æ•°çš„æ–¹æ³•</li></ol> <h2 id="çˆ¶ä¼ æ›´æ·±çš„åä»£"><a href="#çˆ¶ä¼ æ›´æ·±çš„åä»£" class="header-anchor">#</a> çˆ¶ä¼ æ›´æ·±çš„åä»£</h2> <p>ä¸€èˆ¬å¾€æ·±åº¦å±‚çº§ä¼ é€’å€¼ï¼Œæœ‰è¿™ä¸¤ç§æ–¹å¼ï¼š</p> <ul><li>provide / inject</li> <li>vuex</li></ul> <h3 id="provide-inject"><a href="#provide-inject" class="header-anchor">#</a> provide / inject</h3> <p>ä¸€çœ‹åˆ°â€œæ·±â€è¿™ä¸ªå­—ï¼Œå¤§å®¶è‚¯å®šç¬¬ä¸€æƒ³åˆ°çš„å°±<code>Vue2</code>ä¸­çš„<code>provide / inject</code>é€‰é¡¹ã€‚æ²¡é”™ï¼Œè¿™å¥—é€»è¾‘åœ¨<code>vue3</code>ä¸­åŒæ ·é€‚ç”¨ï¼Œè¿™ä¸¤ä¸ªé€‰é¡¹å˜æˆäº†ä¸¤ä¸ªæ–¹æ³•ã€‚</p> <p><code>provide</code>å…è®¸æˆ‘ä»¬å‘å½“å‰ç»„ä»¶çš„æ‰€æœ‰åä»£ç»„ä»¶ï¼Œä¼ é€’ä¸€ä»½æ•°æ®ï¼Œæ‰€æœ‰åä»£ç»„ä»¶èƒ½å¤Ÿé€šè¿‡<code>inject</code>è¿™ä¸ªæ–¹æ³•æ¥å†³å®šæ˜¯å¦æ¥å—è¿™ä»½æ•°æ®ã€‚</p> <p>å¤§è‡´çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š
<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab59c36dfe594131a5f3fb7734ee92c6~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p><strong>å®é™…åº”ç”¨åœºæ™¯</strong></p> <p>ä¸»è¦åº”ç”¨çš„åœºæ™¯æœ‰ä¸¤ä¸­ï¼Œä¸€ç§æ·±åº¦ä¼ é€’ä¸€ä¸ªå‚æ•°æˆ–è€…ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå¦ä¸€ç§æ˜¯ç»™æ’æ§½ä¸Šä¸ç¡®å®šæ€§çš„ç»„ä»¶ä¼ å‚çš„æ—¶å€™ã€‚</p> <p>é‡ç‚¹è¯´ä¸€ä¸‹ç»™æ’æ§½ä¸Šçš„ç»„ä»¶ä¼ å‚ã€‚å…ˆå®ç°ä¸€ä¸ªæœ€å¤–å±‚çš„<code>ValidateForm</code>ç»„ä»¶ï¼Œå®ƒä¸»è¦è´Ÿè´£æ¥å—ä¸€æ•´ä¸ªè¡¨å•æ•°æ®å’Œæ•´ä¸ªè¡¨å•æ•°æ®çš„æ ¡éªŒè§„åˆ™ã€‚å…¶å†…éƒ¨æä¾›äº†ä¸€ä¸ªæ’æ§½ï¼Œç”¨äºæ”¾ç½®ä¸€äº›ä¸ç¡®å®šæ€§çš„ç»„ä»¶ã€‚è¿˜æœ‰ä¸€ä¸ª<code>ValidateFormItem</code>ç»„ä»¶å¯ä»¥æ¥å—ä¸€ä¸ªå­—æ®µåï¼Œé€šè¿‡è¿™å­—æ®µåå‡†ç¡®çŸ¥é“éœ€è¦æ ¡éªŒå“ªä¸ªå­—æ®µï¼ˆtips:åŠŸèƒ½å…¶å®å’Œ<code>element-ui</code>ç±»ä¼¼ï¼‰ã€‚</p> <p>ç»„ä»¶åŒ–å¼€å‘ï¼Œéœ€è¦å°†å‚æ•°å’ŒåŠŸèƒ½è¿›è¡Œè§£è€¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ ·æ¥è®¾è®¡ï¼š</p> <ul><li><code>ValidateForm</code>ï¼š<code>model</code>ï¼Œ<code>rules</code>ï¼Œåªç®¡æ¥å—æ•´ä»½è¡¨å•çš„æ•°æ®å’Œæ ¡éªŒè§„åˆ™</li> <li><code>ValidateFormItem</code>ï¼š<code>prop</code>ï¼Œåªç®¡æ¥å—å­—æ®µåï¼Œåªéœ€çŸ¥é“è‡ªå·±éœ€è¦éªŒè¯å“ªä¸€ä¸ªå­—æ®µ</li></ul> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ValidateForm ref<span class="token operator">=</span><span class="token string">&quot;validateFormRef&quot;</span> <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">&quot;formData&quot;</span> <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">&quot;rules&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·å&quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;keyword&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fieldç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;å¯†ç &quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fieldç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateForm<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><p>å¦‚æœ<code>ValidateFormItem</code>ç»„ä»¶éœ€è¦é€šè¿‡<code>prop</code>å»æ•ˆéªŒæŸä¸ªå­—æ®µï¼Œé‚£å®ƒå°±éœ€è¦æ‹¿åˆ°é‚£ä»½è¡¨å•çš„æ•°æ®ï¼Œé€šè¿‡<code>formData[prop]</code>å»å–åˆ°é‚£ä¸ªå­—æ®µçš„å€¼ï¼Œé‚£è¿™ä»½<code>formData</code>ä»å“ªé‡Œæ¥å‘¢ï¼Ÿé¦–å…ˆä¸å¯èƒ½æ¯å†™ä¸€ä¸ª<code>ValidateFormItem</code>ç»„ä»¶éƒ½ä¼ é€’ä¸€ä»½ã€‚å› ä¸ºï¼Œå®é™…å¼€å‘ä¸­æˆ‘ä»¬å¹¶ä¸èƒ½ç¡®å®šåœ¨<code>ValidateForm</code>ä¸‹è¦å†™å¤šå°‘ä¸ª<code>ValidateFormItem</code>ç»„ä»¶ï¼Œå¦‚æœæ¯å†™ä¸€ä¸ªéƒ½æ‰‹åŠ¨ä¼ é€’ä¸€ä»½è¡¨å•çš„æ•°æ®ï¼Œè¿™äº›å†™èµ·æ¥å°±ä¼šå¤šäº†å¾ˆå¤šå†—ä½™çš„ä»£ç è€Œä¸”ä¹Ÿå¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ï¼Œå°±ç”±<code>ValidateForm</code>è¿™ä¸ªç»„ä»¶ç‹¬ç«‹æ¥å—å¹¶åˆ†å‘ä¸‹æ¥ã€‚</p> <p><strong>ValidateForm</strong></p> <p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦<code>ValidateForm</code>æ¥å‘ä¸‹åˆ†å‘æ•°æ®ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> provide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> modelKey <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> rulesKey <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ValidateForm'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    model<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> Object
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    rules<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> Object
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å‘åä»£å‘æ”¾æ•°æ®</span>
    <span class="token function">provide</span><span class="token punctuation">(</span>modelKey<span class="token punctuation">,</span> props<span class="token punctuation">.</span>model<span class="token punctuation">)</span>
    <span class="token function">provide</span><span class="token punctuation">(</span>rulesKey<span class="token punctuation">,</span> props<span class="token punctuation">.</span>rules<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>ValidateFormItem</strong></p> <p><code>ValidateFormItem</code>æ¥å—ä¸Šé¢ä¼ é€’çš„æ•°æ®ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> provide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> modelKey<span class="token punctuation">,</span> rulesKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./ValidateForm.vue'</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ValidateFormItem'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    label<span class="token operator">:</span> String<span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    prop<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¥å—ValidateFormä¼ ä¸‹æ¥çš„æ•°æ®</span>
    <span class="token keyword">const</span> model <span class="token operator">=</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>modelKey<span class="token punctuation">,</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>rulesKey<span class="token punctuation">,</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// æ ¹æ®props.propåœ¨modelå’Œrulesåˆ†åˆ«å–å‡ºéœ€è¦ æ ¡éªŒçš„æ•°æ® å’Œ æ ¡éªŒçš„è§„åˆ™</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span>props<span class="token punctuation">.</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rules<span class="token punctuation">[</span>props<span class="token punctuation">.</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// æ•°æ®æ ¡éªŒçš„é€»è¾‘</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>provide / inject æ€»ç»“</strong></p> <p>åœ¨è¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/6903796293445877773" target="_blank" rel="noopener noreferrer">Vue ç»„ä»¶é€šä¿¡æ–¹å¼åŠå…¶åº”ç”¨åœºæ™¯æ€»ç»“<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­ï¼Œå¤§ä½¬å¯¹å…¶çš„ä¼˜ç¼ºç‚¹å·²ç»æ€»ç»“å¾ˆå¥½äº†ã€‚è¿™é‡Œæä¸€ä¸‹å®ƒçš„ç¼ºç‚¹ï¼Œå°±æ˜¯ä¸èƒ½è§£å†³å…„å¼Ÿç»„ä»¶çš„é€šä¿¡ã€‚</p> <h3 id="vuex"><a href="#vuex" class="header-anchor">#</a> vuex</h3> <p><code>vuex</code>ä¸€ç›´ä»¥æ¥æ˜¯<code>vue</code>ç”Ÿæ€ä¸­ä¸€ä¸ªè§£å†³ä¸åŒå±‚çº§ç»„ä»¶æ•°æ®å…±äº«çš„ä¼˜è´¨æ–¹æ¡ˆã€‚ä¸ä»…æ˜¯åœ¨çˆ¶ä¼ å­ä¸­å¯ä»¥é€‚ç”¨ï¼Œåœ¨å­ä¼ çˆ¶ï¼Œæˆ–è€…ç¥–å…ˆä¼ åä»£ï¼Œåä»£ä¼ ç¥–å…ˆï¼Œå…„å¼Ÿç»„ä»¶é—´éƒ½æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ¡ˆã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé›†ä¸­çŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚å…¶æœ¬è´¨å®ç°ä¹Ÿæ˜¯å“åº”å¼çš„ã€‚è¿™é‡Œåªç®€å•æä¸€ä¸‹<code>Vue3</code>ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p> <p><strong>åˆ›å»ºä¸€ä¸ª<code>store</code></strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">export</span> <span class="token keyword">enum</span> Mutarions <span class="token punctuation">{</span>
  <span class="token constant">SET_COUNT</span> <span class="token operator">=</span> <span class="token string">'SET_COUNT'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">231</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">count</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>Mutarions<span class="token punctuation">.</span><span class="token constant">SET_COUNT</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> num<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>count <span class="token operator">=</span> num<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>çˆ¶ç»„ä»¶</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>father<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>Son ref<span class="token operator">=</span><span class="token string">&quot;sonRef&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'@/components/Son.vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Mutarions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/store/index'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Father'</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    Son
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> valueRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>Mutarions<span class="token punctuation">.</span><span class="token constant">SET_COUNT</span><span class="token punctuation">,</span> valueRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>å­ç»„ä»¶</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Son<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Son'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>count<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="å­ä¼ çˆ¶"><a href="#å­ä¼ çˆ¶" class="header-anchor">#</a> å­ä¼ çˆ¶</h2> <p>å­çº§å‘çˆ¶çº§ä¼ é€’æ•°æ®ï¼Œå¯ä»¥æœ‰è¿™ä¸‰ç§æ–¹å¼ï¼š</p> <ul><li>v-on</li> <li>refs æ–¹å¼</li> <li>äº‹ä»¶ä¸­å¿ƒ</li></ul> <h3 id="refs-æ–¹å¼-2"><a href="#refs-æ–¹å¼-2" class="header-anchor">#</a> refs æ–¹å¼</h3> <p>é€šè¿‡<code>ref</code>çš„æ–¹å¼å‘çˆ¶çº§ä¼ é€’ä¸€ä¸ªæ•°æ®æ˜¯åŒæ ·é€‚ç”¨çš„ã€‚å…·ä½“æ€è·¯ï¼šå­ç»„ä»¶å†…éƒ¨å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå€¼ã€‚çˆ¶çº§ç»„ä»¶é€šè¿‡<code>ref</code>å–åˆ°å­ç»„ä»¶å®ä¾‹åè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¾—åˆ°éœ€è¦çš„è¿”å›å€¼ã€‚</p> <p>è¿™é‡Œæ¥çœ‹ä¸€ä¸‹å®é™…çš„åº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å¸Œæœ›<code>ValidateForm</code>ç»„ä»¶å»éªŒè¯ä¸‹é¢æ‰€æœ‰çš„è¡¨å•é¡¹ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå‡½æ•°å°†ç»„ä»¶å†…éƒ¨çš„ä¸€ä¸ªéªŒè¯çŠ¶æ€è¿”å›å‡ºå»ã€‚</p> <p><strong>çˆ¶ç»„ä»¶</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ValidateForm ref<span class="token operator">=</span><span class="token string">&quot;validateFormRef&quot;</span> <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">&quot;formData&quot;</span> <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">&quot;rules&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·å&quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;keyword&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fieldç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;å¯†ç &quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fieldç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateForm<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'demo'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>

    <span class="token keyword">const</span> validateFormRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// é€šè¿‡validateæ‹¿åˆ°ValidateFormç»„ä»¶å†…éƒ¨çš„ä¸€ä¸ªéªŒè¯çŠ¶æ€</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>validateFormRef<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è¡¨å•éªŒè¯æˆåŠŸåï¼Œåšåç»­çš„æ“ä½œ</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      validateFormRef
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>ValidateForm</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ValidateForm'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">validate</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token comment">// è°ƒç”¨æ’æ§½ä¸‹æ‰€æœ‰ValidateFormItemç»„ä»¶å†…éƒ¨çš„æ ¡éªŒæ–¹æ³•</span>
      <span class="token comment">//ï¼ˆtips:è‡³äºå¦‚ä½•è°ƒç”¨ï¼Œåé¢çš„äº‹ä»¶ä¸­å¿ƒä¼šé‡ç‚¹è¯´ï¼‰</span>
      <span class="token comment">// å¦‚æœæœ‰ä¸€ä¸ªæ ¡éªŒæ–¹æ³•è¿”å›çš„æ˜¯falseå°±ç›´æ¥è¿”å›false</span>
      <span class="token comment">// å¦‚æœéƒ½ä¸ºtrueå°±è¿”å›ä¸€ä¸ªtrue</span>

      <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      validate
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>è¿™é‡Œæ¥çœ‹ä¸€ä¸‹å¤§è‡´çš„æµç¨‹å›¾ï¼š</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17111a8ec61c46a193e6177d5a25cdcd~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p>é€šè¿‡è¯¥ç§æ–¹æ³•è¿˜å¯ä»¥æ‹¿åˆ°å­ç»„ä»¶å†…éƒ¨çš„æ•°æ®ï¼Œè¿™å°±è·Ÿé—­åŒ…å‡½æ•°ä¸€æ ·çš„é“ç†ã€‚</p> <h3 id="äº‹ä»¶ä¸­å¿ƒ"><a href="#äº‹ä»¶ä¸­å¿ƒ" class="header-anchor">#</a> äº‹ä»¶ä¸­å¿ƒ</h3> <p>è¿™ç§é€šä¿¡æ–¹å¼ä¸ºä»€ä¹ˆæ‹¿åˆ°è¿™é‡Œæ¥è®²å‘¢ï¼Ÿå› ä¸ºæˆ‘è§‰æ¥ä¸‹çš„å®é™…æ¡ˆä¾‹ç”¨ä¸Šäº‹ä»¶ä¸­å¿ƒè¿™ç§æ–¹å¼ä¼šéå¸¸çš„æ°å½“ã€‚åœ¨ä¸Šä¸€ä¸ªå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç•™ä¸‹æ¥ä¸€ä¸ªå‘ï¼Œé‚£å°±æ˜¯<code>ValidateForm</code>ç»„ä»¶è¦å»éªŒè¯æ•´ä¸ªè¡¨å•æ˜¯å¦é€šè¿‡ï¼Œå°±å¿…é¡»æƒ³åŠæ³•è®©æ¯ä¸ª<code>ValidateFormItem</code>å°†å†…éƒ¨çš„æ ¡éªŒç»“æœè¿”å›ç»™å®ƒã€‚</p> <p><strong>é¦–å…ˆä¼šé‡åˆ°ä¸¤ä¸ªé—®é¢˜</strong></p> <ol><li><code>ValidateForm</code>ä¸‹é¢çš„ç»„ä»¶æ˜¯é€šè¿‡æ’æ§½å»æŒ‚è½½çš„ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡<code>ref</code>çš„æ–¹å¼å»æ‹¿åˆ°æ¯ä¸ªå­è¡¨å•é¡¹çš„å®ä¾‹ï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•æ‹¿åˆ°æ¯ä¸ª<code>ValidateFormItem</code>çš„éªŒè¯çŠ¶æ€äº†ã€‚</li> <li>ä¸Šé¢çš„ç« èŠ‚ä¸­æœ‰ä¸€ä¸ªå›¾ç‰‡ï¼Œå±•ç¤ºäº†é€šè¿‡<code>ref</code>æ‹¿åˆ°çš„ç»„ä»¶å®ä¾‹ã€‚å¯ä»¥å‘ç°ï¼Œä½ å¯ä»¥æ‰¾åˆ°<code>$parent</code>å±æ€§ï¼Œä½†æ˜¯æ²¡æœ‰<code>$children</code>å±æ€§ã€‚è¿™å°±å¾ˆå°´å°¬äº†ï¼Œæˆ‘ä»¬æ²¡åŠæ³•åƒ<code>Vue2</code>ä¸€æ ·åœ¨<code>ValidateForm</code>ä¸­é€šè¿‡<code>$children</code>æ‹¿åˆ°æ¯ä¸ªå­ç»„ä»¶çš„å®ä¾‹ã€‚</li></ol> <p><strong>è§£å†³æ€è·¯</strong></p> <p>æ—¢ç„¶æ²¡æœ‰åŠæ³•æ‹¿åˆ°æ’æ§½ä¸Šçš„ç»„ä»¶å®ä¾‹ï¼Œé‚£å’±ä»¬å°±ç»•å¼€å®ƒï¼Œé€šè¿‡ä¸€ä¸ªäº‹ä»¶ä¸­å¿ƒçš„æ–¹å¼æ¥è§£å†³ã€‚æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p> <ol><li>åœ¨<code>ValidateForm</code>å®ä¾‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå»åˆ›å»ºä¸€ä¸ªäº‹ä»¶ä¸­å¿ƒ<code>Emitter</code>å®ä¾‹ï¼Œå®ƒå¯ä»¥æ³¨å†Œä¸€ä¸ªäº‹ä»¶ï¼Œå½“è¿™ä¸ªäº‹ä»¶è¢«æ‰§è¡Œæ—¶å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚</li> <li>å°†è¿™ä¸ª<code>Emitter</code>é€šè¿‡<code>provide</code>ä¼ é€’ç»™åä»£ï¼Œä¿è¯è¿™ä¸ªäº‹ä»¶ä¸­å¿ƒåœ¨ä¸åŒçš„<code>ValidateForm</code>ç»„ä»¶ä¸­éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¦‚æœå†™äº†å¤šä¸ª<code>ValidateForm</code>ï¼Œä»–ä»¬çš„äº‹ä»¶ä¸­å¿ƒä¸ä¼šç›¸äº’å¹²æ‰°ã€‚</li> <li>åœ¨<code>ValidateFormItem</code>ä¸­ä½¿ç”¨<code>inject</code>æ¥æ”¶è‡ªå·±æ‰€åœ¨è¡¨å•åŸŸçš„<code>Emitter</code>ï¼Œåœ¨æŒ‚è½½çš„æ—¶å€™ï¼Œæ‰§è¡Œ<code>Emitter</code>ä¸Šçš„äº‹ä»¶ï¼Œå°†è‡ªå·±çš„å†…éƒ¨çš„<code>validate</code>å‡½æ•°ï¼Œä¼ é€’å‘é€ç»™<code>ValidateForm</code>ï¼Œå¹¶ç”±å…¶å°†æ–¹æ³•ç¼“å­˜åœ¨é˜Ÿåˆ—ä¸­ã€‚</li> <li><code>ValidateForm</code>æ‰§è¡Œæ ¡éªŒçš„æ—¶å€™ï¼Œå°±å¯ä»¥æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ ¡éªŒå‡½æ•°ï¼Œå¹¶å¾—å‡ºæ ¡éªŒç»“æœã€‚</li></ol> <p>å…·ä½“ä»£ç å®ç°ï¼š</p> <p>å…ˆæ¥å®ç°ä¸€ä¸ª<code>Emitter</code>äº‹ä»¶ä¸­å¿ƒçš„ç±»</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EmitterHandles <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/type/utils'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Emitter</span> <span class="token punctuation">{</span>
  <span class="token comment">// å­˜æ”¾äº‹ä»¶å‡½æ•°</span>
  <span class="token keyword">private</span> events<span class="token operator">:</span> EmitterHandles <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// ç”¨äºæ³¨å†Œäº‹ä»¶</span>
  <span class="token function">on</span><span class="token punctuation">(</span>eventName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> eventHandle<span class="token operator">:</span> <span class="token builtin">Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> eventHandle
  <span class="token punctuation">}</span>

  <span class="token comment">// åˆ é™¤äº‹ä»¶</span>
  <span class="token function">off</span><span class="token punctuation">(</span>eventName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è§¦å‘äº‹ä»¶</span>
  <span class="token function">emit</span><span class="token punctuation">(</span>eventName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>rest<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“äº‹ä»¶ä¸­å¿ƒå®ç°å¥½äº†ï¼Œè¿™é‡Œæ¥å®Œå–„ä¸€ä¸‹<code>ValidateForm</code>çš„ä»£ç </p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> nextTick<span class="token punctuation">,</span> provide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Emitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/emitter'</span>

<span class="token keyword">type</span> <span class="token class-name">ValidateFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> emitterKey <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> modelKey <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> rulesKey <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ValidateForm'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    model<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> Object
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    rules<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> Object
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°†è¡¨å•æ•°æ®å’ŒéªŒè¯è§„åˆ™ä¼ é€’ç»™åä»£</span>
    <span class="token function">provide</span><span class="token punctuation">(</span>modelKey<span class="token punctuation">,</span> props<span class="token punctuation">.</span>model<span class="token punctuation">)</span>
    <span class="token function">provide</span><span class="token punctuation">(</span>rulesKey<span class="token punctuation">,</span> props<span class="token punctuation">.</span>rules<span class="token punctuation">)</span>

    <span class="token comment">// åˆ›å»ºäº‹ä»¶ä¸­å¿ƒçš„å®ä¾‹</span>
    <span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// å°†äº‹ä»¶ä¸­å¿ƒä¼ é€’ç»™åä»£</span>
    <span class="token function">provide</span><span class="token punctuation">(</span>emitterKey<span class="token punctuation">,</span> emitter<span class="token punctuation">)</span>

    <span class="token comment">// æ¥å—formItemç»„ä»¶è¿”å›çš„éªŒè¯å‡½æ•°</span>
    <span class="token comment">// å¹¶ä¸”å°†å…¶å­˜èµ·æ¥</span>
    emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'acceptValidate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>validateFunc<span class="token operator">:</span> ValidateFunc<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      validateList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>validateFunc<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// ç”¨äºæ¥å—ä¿å­˜åä»£è¿”å›çš„éªŒè¯æ–¹æ³•</span>
    <span class="token keyword">const</span> validateList<span class="token operator">:</span> ValidateFunc<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment">// éªŒè¯æ‰€æœ‰æ•°æ®çš„çŠ¶æ€</span>
    <span class="token keyword">const</span> <span class="token function-variable function">validate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ‰§è¡Œæ¯ä¸€ä¸ªå­è¡¨å•å‘é€è¿‡æ¥çš„éªŒè¯æ–¹æ³•</span>
     <span class="token keyword">return</span> validateList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fn <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>valid <span class="token operator">=&gt;</span> valid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      validate
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>okï¼Œç°åœ¨å®ç°äº†<code>validateForm</code>çš„é€»è¾‘ï¼Œæˆ‘ä»¬å†æ¥å†™ä¸€ä¸‹<code>validateFormItem</code>çš„é€»è¾‘</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>label v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;label&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot; col-form-label&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> label <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>small v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;error.isError&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;invalid-feedback&quot;</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token punctuation">{</span> error<span class="token punctuation">.</span>errorMessage <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>small<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Emitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/emitter'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> provide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> emitterProviderKey<span class="token punctuation">,</span> modelKey<span class="token punctuation">,</span> rulesKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./ValidateForm.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ValidateFormItem'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    label<span class="token operator">:</span> String<span class="token punctuation">,</span>
    required<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    prop<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¥å—Emitteräº‹ä»¶ä¸­å¿ƒ</span>
    <span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span>Emitter<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>emitterProviderKey<span class="token punctuation">)</span>
    <span class="token comment">// æ¥å—æ•°æ®å’Œæ ¡éªŒè§„åˆ™</span>
    <span class="token keyword">const</span> model <span class="token operator">=</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>modelKey<span class="token punctuation">)</span>
    <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>rulesKey<span class="token punctuation">)</span>

    <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      isError<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      errorMessage<span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// æ ¡éªŒå¯¹åº”çš„å­—æ®µæ•°æ®</span>
    <span class="token keyword">const</span> <span class="token function-variable function">validateField</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> prop <span class="token operator">=</span> props<span class="token punctuation">.</span>prop
      <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">&amp;&amp;</span> model <span class="token operator">&amp;&amp;</span> rules <span class="token operator">&amp;&amp;</span> rules<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> rules<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">.</span><span class="token function">validator</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            error<span class="token punctuation">.</span>isError <span class="token operator">=</span> <span class="token boolean">true</span>
            error<span class="token punctuation">.</span>errorMessage <span class="token operator">=</span> item<span class="token punctuation">.</span>message
            <span class="token keyword">return</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>result
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// å½“ç»„ä»¶æŒ‚è½½çš„æ—¶å€™ï¼Œå°†è‡ªèº«çš„æ ¡éªŒå‡½æ•°å‘é€ç»™ValidateFormç»„ä»¶</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      emitter <span class="token operator">&amp;&amp;</span> emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'acceptValidate'</span><span class="token punctuation">,</span> validateField<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      error
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>ä¸ºäº†æ›´è¯¦ç»†çš„ç†è§£ä¸Šé¢çš„è¿‡ç¨‹ï¼Œè¿™é‡Œæ¥ç”»ä¸€ä¸ªç¤ºæ„å›¾ï¼š</p> <ol><li>æ³¨å†Œäº‹ä»¶ï¼Œåˆ†å‘äº‹ä»¶ä¸­å¿ƒ</li></ol> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8266bd8e41b4d1a9322b4d92f43ccc8~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <ol start="2"><li>æ‰§è¡Œäº‹ä»¶ï¼Œå‘é€éªŒè¯å‡½æ•°</li></ol> <p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/57255b6f8a9f4f9bb6f51fd015891a46~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p>æ•´ä¸ªè¿‡ç¨‹çš„æ€»ç»“å°±æ˜¯ï¼Œé¡¶å±‚ç»„ä»¶åˆ›å»ºå’Œåˆ†å‘äº‹ä»¶ä¸­å¿ƒï¼Œå¹¶æ³¨å†Œäº‹ä»¶ç›‘å¬å‡½æ•°ã€‚åä»£ç»„ä»¶æ‰§è¡Œè¯¥äº‹ä»¶ç„¶åå‘é€ä¿¡æ¯ï¼Œé¡¶å±‚ç»„ä»¶å›æ”¶ä¿¡æ¯ã€‚</p> <p><strong>Tips</strong></p> <p>è¿™é‡Œå†æä¸€ç‚¹ï¼Œåœ¨ä½¿ç”¨<code>Emitter</code>è¿™ä¸ªäº‹ä»¶ä¸­å¿ƒçš„æ—¶å€™ï¼Œæ˜¯åœ¨<code>ValidateForm</code>çš„<code>setup</code>ä¸­å»åˆ›å»ºå¹¶ä¸”å»ä¸‹å‘çš„ï¼Œå¹¶ä¸æ˜¯ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„äº‹ä»¶ä¸­å¿ƒã€‚å°±åƒå¤§ä½¬çš„è¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/6903796293445877773" target="_blank" rel="noopener noreferrer">Vue ç»„ä»¶é€šä¿¡æ–¹å¼åŠå…¶åº”ç”¨åœºæ™¯æ€»ç»“<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­æ€»ç»“åˆ°çš„ï¼Œäº‹ä»¶æ€»çº¿çš„å½¢å¼æ˜¯æœ‰ä¸€ä¸ªè‡´å‘½ç¼ºç‚¹çš„ï¼Œå¦‚æœä¸€ä¸ªé¡µé¢ä¸Šæœ‰å¤šä¸ªå…¬å…±ç»„ä»¶ï¼Œæˆ‘ä»¬åªè¦å‘å…¶ä¸­çš„ä¸€ä¸ªä¼ é€’æ•°æ®ï¼Œä½†æ˜¯æ¯ä¸ªå…¬å…±ç»„ä»¶éƒ½ç»‘å®šäº†æ•°æ®æ¥å—çš„æ–¹æ³•ï¼Œé‚£å°±ä¼šå‡ºç°æ··ä¹±çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„äº‹ä»¶æ€»çº¿ä¸æ˜¯ä¸€ä¸ªå…¨å±€çš„ï¼Œè€Œæ˜¯å•ä¸ªä½œç”¨åŸŸé‡Œé¢çš„ä¸€ä¸ªäº‹ä»¶ä¸­å¿ƒã€‚</p> <p>å› ä¸ºäº‹ä»¶ä¸­å¿ƒæ˜¯åœ¨å½“å‰ç»„ä»¶å†…éƒ¨åˆ›å»ºï¼Œå¹¶ä½¿ç”¨<code>provide</code>å‘ä¸‹å‘å¸ƒçš„ï¼Œè¿™æ ·å°±åªæœ‰å½“å‰ç»„ä»¶çš„åä»£æ‰èƒ½ä½¿ç”¨è¿™ä¸ªäº‹ä»¶ä¸­å¿ƒã€‚æ‰€ä»¥ï¼Œå°±ç®—ä¸€ä¸ªé¢ä¸Šå†™äº†å¤šä¸ª<code>ValidateForm</code>ï¼Œä»–ä»¬çš„æ ¡éªŒéƒ½æ˜¯ç‹¬ç«‹çš„ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ValidateForm ref<span class="token operator">=</span><span class="token string">&quot;validateFormRef1&quot;</span> <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">&quot;formData1&quot;</span> <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">&quot;rules&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·å&quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;keyword&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fieldç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;å¯†ç &quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fieldç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateForm<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>ValidateForm ref<span class="token operator">=</span><span class="token string">&quot;validateFormRef2&quot;</span> <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">&quot;formData2&quot;</span> <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">&quot;rules&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;ç”¨æˆ·å&quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;keyword&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fieldç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>ValidateFormItem label<span class="token operator">=</span><span class="token string">&quot;å¯†ç &quot;</span> prop<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> fieldç»„ä»¶ <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateFormItem<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ValidateForm<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><p>ç¤ºæ„å›¾ï¼š</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dddce9e4d09a4db5b07dd33cefafdc0a~tplv-k3u1fbpfcp-watermark.image" alt=""></p> <p><strong>äº‹ä»¶ä¸­å¿ƒæ€»ç»“</strong></p> <p>ä¼˜ç‚¹ï¼š</p> <ol><li>å¯ä»¥è§£å†³<code>Vue3</code>ä¸èƒ½ä½¿ç”¨<code>this.$children</code>çš„é—®é¢˜</li> <li>å¯ä»¥çµæ´»ä½¿ç”¨ï¼Œä¸å—ç»„ä»¶å±‚çº§çš„é™åˆ¶</li> <li>è¿™ç§é€šä¿¡æ–¹å¼ä¸å—æ¡†æ¶çš„é™åˆ¶</li></ol> <p>ç¼ºç‚¹ï¼š</p> <ol><li>éœ€è¦æ§åˆ¶å¥½äº‹ä»¶ä¸­å¿ƒçš„ä½œç”¨èŒƒå›´</li> <li>éœ€è¦æ§åˆ¶å¥½äº‹ä»¶åçš„è§„èŒƒ</li></ol> <h2 id="äº‹ä»¶ä¸­å¿ƒè¿›é˜¶"><a href="#äº‹ä»¶ä¸­å¿ƒè¿›é˜¶" class="header-anchor">#</a> äº‹ä»¶ä¸­å¿ƒè¿›é˜¶</h2> <p>å› ä¸ºåœ¨<code>Vue3</code>çš„<code>Composition API</code>ä¸­ï¼Œ<code>vue</code>çš„åŠŸèƒ½ api æ›´åŠ çš„é¢—ç²’åŒ–ã€‚æˆ‘ä»¬å¯ä»¥å¯¹äº‹ä»¶ä¸­å¿ƒè¿›è¡Œä¸€ä¸ªè‡ªå®šä¹‰éœ€æ±‚çš„æ”¹é€ ã€‚</p> <p>å¯ä»¥é€šè¿‡å¼•å…¥<code>reactive, ref</code>å¸®åŠ©æˆ‘ä»¬çš„äº‹ä»¶ä¸­å¿ƒå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå“åº”å¼çš„æ•°æ®ï¼Œå¯ä»¥å®ç°å½“äº‹ä»¶ä¸­å¿ƒè¿›è¡Œä¸€å®šé€šä¿¡è¡Œä¸ºæ—¶ï¼Œå»æ›´æ–°å¯¹åº”çš„è§†å›¾ã€‚è¿˜å¯ä»¥å¼•å…¥<code>computed</code>å®ç°è®¡ç®—å±æ€§çš„åŠŸèƒ½ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Emitter</span> <span class="token punctuation">{</span>
  <span class="token comment">// å“åº”å¼çš„æ•°æ®ä¸­å¿ƒ</span>
  <span class="token keyword">private</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> events<span class="token operator">:</span> EmitterHandles <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// è®°å½•å½“å‰äº‹ä»¶ä¸­å¿ƒ äº‹ä»¶çš„æ•°é‡</span>
  <span class="token keyword">private</span> eventLength <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>events<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>

  <span class="token comment">// çœç•¥éƒ¨åˆ†ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre></div><p>åŠ å…¥<code>watch,watchEffect</code>å®ç°æ•°æ®ç›‘å¬åšå‡ºä¸€å®šé€»è¾‘è¡Œä¸ºçš„åŠŸèƒ½ã€‚æˆ‘è®¤ä¸º<code>Composition API</code>å’Œ<code>React Hooks Api</code>éƒ½æ˜¯éå¸¸å¼ºå¤§ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æˆ‘ä»¬å°†åŠŸèƒ½å‡½æ•°å½“æˆç§¯æœ¨ä¸€æ ·å»ä»»æ„ç»„è£…æˆæˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„åº”ç”¨ç¨‹åºã€‚</p> <h2 id="æ·±å±‚åä»£å‘é¡¶å±‚é€šä¿¡-å…„å¼Ÿé€šä¿¡"><a href="#æ·±å±‚åä»£å‘é¡¶å±‚é€šä¿¡-å…„å¼Ÿé€šä¿¡" class="header-anchor">#</a> æ·±å±‚åä»£å‘é¡¶å±‚é€šä¿¡ï¼Œå…„å¼Ÿé€šä¿¡</h2> <p>æˆ‘è§‰å¾—å…¶å®å…¶ä»–çš„åœºæ™¯ï¼Œå…¶é€šä¿¡æ–¹å¼åŸºæœ¬éƒ½å·®ä¸å¤šäº†ï¼Œæ‰€è°“åƒç¯‡ä¸€å¾‹ã€‚åä»£å‘ç¥–å…ˆä¼ å€¼ï¼Œæˆ–è€…å…„å¼Ÿç»„ä»¶ä¼ å€¼ï¼Œéƒ½å¯ä»¥ä½¿ç”¨<code>vuex</code>æˆ–è€…æ˜¯<code>äº‹ä»¶ä¸­å¿ƒ</code>çš„æ–¹å¼ã€‚å…„å¼Ÿå±‚çº§ï¼Œæˆ–è€…ç›¸é‚»å±‚çº§çš„ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>ref</code>,<code>$parent</code>ç­‰æ–¹å¼ã€‚</p> <h2 id="æœ€å"><a href="#æœ€å" class="header-anchor">#</a> æœ€å</h2> <p>æˆ‘ä¸ªäººå¯¹<code>Vue3</code>è¿˜æ˜¯éå¸¸çœ‹å¥½çš„ï¼Œç›®å‰å¯¹äºå…¬å¸çš„éƒ¨åˆ†æ—§é¡¹ç›®ï¼Œä¹Ÿæ€è€ƒå¦‚ä½•å»ç”¨<code>Vue3</code>å»é‡æ„å®ƒã€‚ç„¶åæˆ‘ä¹Ÿæ˜¯å› ä¸ºåˆšå¥½çœ‹äº†ç¤¾åŒºå¤§ä½¬çš„æ–‡ç« ç»å¯¹éå¸¸æœ‰æ„æ€ï¼Œäºæ˜¯æ¥äº†å…´è¶£å†™äº†ä¸€ä¸ª<code>Vue3</code>é€šä¿¡æ€»ç»“ ğŸ˜‚ï¼Œå¯èƒ½è¿˜æœ‰å¾ˆå¤šåœ°æ–¹è¯´çš„ä¸æ˜¯å¾ˆåˆ°ä½ã€‚</p> <p>å¦‚æœæœ‰é”™è¯¯æˆ–è€…æ˜¯è¡¥å……ï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œå¦‚æœè§‰å¾—è¿˜è¡Œå¯¹ä½ æœ‰å¸®åŠ©å°±åŠ³çƒ¦ç‚¹ä¸ªèµå“ˆå“ˆï¼ŒğŸ™ è°¢è°¢å„ä½é“ä»”é“å¥³ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/tangmouren/Vue/" class="prev router-link-active">
        å¼€å§‹
      </a></span> <span class="next"><a href="/tangmouren/Vue/å®ç°ä¸€ä¸ªç®€å•çš„Vue3æ¡†æ¶.html">
        å®ç°ä¸€ä¸ªç®€å•çš„Vue3æ¡†æ¶
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/tangmouren/assets/js/app.6489800f.js" defer></script><script src="/tangmouren/assets/js/2.18399b14.js" defer></script><script src="/tangmouren/assets/js/10.fbff40b9.js" defer></script>
  </body>
</html>
